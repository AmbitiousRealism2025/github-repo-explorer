import{C as l,A as m,k as $,l as i,T as h}from"./errorBoundary-Bh1k4IQJ.js";const f=()=>{const e={Accept:"application/vnd.github+json","X-GitHub-Api-Version":m},t=localStorage.getItem("gh-token");return t&&(e.Authorization=`Bearer ${t}`),e},R=e=>new Promise(t=>setTimeout(t,e)),d=new Map,w=e=>{const t=d.get(e);return t?Date.now()-t.timestamp>l?(d.delete(e),null):(console.log(`[Cache] HIT: ${e.substring(0,60)}...`),t.data):null},y=(e,t)=>{if(d.set(e,{data:t,timestamp:Date.now()}),d.size>$){const r=d.keys().next().value;d.delete(r)}},a=async(e,t=3,r=1e3,n=!0)=>{if(n){const s=w(e);if(s)return s}try{const s=await fetch(e,{headers:f()});if(s.status===403){const c=s.headers.get("x-ratelimit-remaining"),g=s.headers.get("x-ratelimit-reset");if(c==="0"){const p=new Date(parseInt(g)*1e3);throw new Error(`Rate limit exceeded. Resets at ${p.toLocaleTimeString()}`)}throw new Error("Forbidden: Check your access token")}if(s.status===404)throw new Error("Resource not found");if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const o={data:await s.json(),rateLimit:{remaining:parseInt(s.headers.get("x-ratelimit-remaining")||"0"),limit:parseInt(s.headers.get("x-ratelimit-limit")||"0"),reset:parseInt(s.headers.get("x-ratelimit-reset")||"0")}};return n&&y(e,o),o}catch(s){if(t>0&&!s.message.includes("Rate limit")){const o=Math.random()*100;return await R(r+o),a(e,t-1,r*2,n)}throw s}},C=async(e,t={})=>{const{language:r="",minStars:n=0,sort:s="stars",order:o="desc",page:c=1,perPage:g=30}=t;let p=e;r&&(p+=`+language:${encodeURIComponent(r)}`),n>0&&(p+=`+stars:>=${n}`);const u=`${i}/search/repositories?q=${encodeURIComponent(p)}&sort=${s}&order=${o}&page=${c}&per_page=${g}`;return a(u)},T=async(e={})=>{const{language:t="",page:r=1,perPage:n=30}=e,s=new Date;s.setDate(s.getDate()-h);let c=`created:>${s.toISOString().split("T")[0]}`;t&&(c+=`+language:${encodeURIComponent(t)}`);const g=`${i}/search/repositories?q=${encodeURIComponent(c)}&sort=stars&order=desc&page=${r}&per_page=${n}`;return a(g)},A=async(e,t)=>{const r=`${i}/repos/${e}/${t}`;return a(r)},E=async(e,t)=>{try{const r=`${i}/repos/${e}/${t}/readme`,n=await a(r);if(n.data.content){const s=atob(n.data.content);return{...n,data:{...n.data,decodedContent:s}}}return n}catch(r){if(r.message.includes("not found"))return{data:null,rateLimit:null};throw r}},S=async(e,t)=>{const r=`${i}/repos/${e}/${t}/languages`;return a(r)},_=async(e,t,r=10)=>{const n=`${i}/repos/${e}/${t}/events?per_page=${r}`;return a(n)},x=async(e,t)=>{const r=`${i}/repos/${e}/${t}/stats/commit_activity`;return a(r)};export{E as a,S as b,_ as c,x as d,T as e,A as g,C as s};
