import{i as T,d as F,t as M,S as r,s as u,a as S,f,u as C,I as c,g as l,b as P,c as R}from"./common-B1Um71dy.js";import{s as w}from"./api-Yir0XPV8.js";T();const L=document.getElementById("search-input"),H=document.getElementById("search-btn"),m=document.getElementById("language-filter"),p=document.getElementById("stars-filter"),v=document.getElementById("sort-filter"),_=document.getElementById("repo-grid"),k=document.getElementById("results-section"),N=document.getElementById("results-count"),I=document.getElementById("empty-state"),B=document.getElementById("loading-state"),$=document.getElementById("error-state"),U=document.getElementById("error-message"),h=document.getElementById("pagination"),q=document.getElementById("theme-toggle"),D=document.getElementById("settings-btn"),i=document.getElementById("settings-modal"),O=document.getElementById("settings-close"),y=document.getElementById("github-token"),x=document.getElementById("save-token"),z=document.getElementById("clear-token"),A=document.getElementById("retry-btn");let n=1,b=0;const J=e=>{const t=r.isFavorite(e.id),a=document.createElement("article");return a.className="repo-card",a.dataset.repoId=e.id,a.innerHTML=`
    <header class="repo-card__header">
      <a href="/detail.html?repo=${encodeURIComponent(e.full_name)}" class="repo-card__name">${e.full_name}</a>
      <button class="repo-card__favorite ${t?"active":""}" aria-label="${t?"Remove from":"Add to"} favorites" data-repo='${JSON.stringify({id:e.id,full_name:e.full_name,description:e.description,html_url:e.html_url,stargazers_count:e.stargazers_count,forks_count:e.forks_count,language:e.language,updated_at:e.updated_at}).replace(/'/g,"&#39;")}'>
        ${t?c.star:c.starOutline}
      </button>
    </header>
    <p class="repo-card__description">${e.description||"No description available"}</p>
    <footer class="repo-card__footer">
      ${e.language?`
        <span class="repo-card__language">
          <span class="language-dot" style="--lang-color: ${P(e.language)}"></span>
          ${e.language}
        </span>
      `:""}
      <span class="repo-card__stat">
        ${c.star}
        ${f(e.stargazers_count)}
      </span>
      <span class="repo-card__stat">
        ${c.fork}
        ${f(e.forks_count)}
      </span>
      <span class="repo-card__updated">Updated ${R(e.updated_at)}</span>
    </footer>
  `,a},G=e=>{_.innerHTML="";const t=document.createDocumentFragment();e.forEach(a=>{t.appendChild(J(a))}),_.appendChild(t)},j=()=>{const e=Math.min(Math.ceil(b/30),34);if(e<=1){h.innerHTML="";return}let t="";t+=`<button class="pagination__btn" ${n===1?"disabled":""} data-page="${n-1}">Prev</button>`;const a=Math.max(1,n-2),s=Math.min(e,n+2);a>1&&(t+='<button class="pagination__btn" data-page="1">1</button>',a>2&&(t+='<span class="pagination__btn" style="border: none;">...</span>'));for(let o=a;o<=s;o++)t+=`<button class="pagination__btn ${o===n?"active":""}" data-page="${o}">${o}</button>`;s<e&&(s<e-1&&(t+='<span class="pagination__btn" style="border: none;">...</span>'),t+=`<button class="pagination__btn" data-page="${e}">${e}</button>`),t+=`<button class="pagination__btn" ${n===e?"disabled":""} data-page="${n+1}">Next</button>`,h.innerHTML=t},g=e=>{switch(I.classList.add("hidden"),B.classList.add("hidden"),$.classList.add("hidden"),k.classList.add("hidden"),e){case"empty":I.classList.remove("hidden");break;case"loading":B.classList.remove("hidden");break;case"error":$.classList.remove("hidden");break;case"results":k.classList.remove("hidden");break}},d=async(e=1)=>{const t=L.value.trim();if(!t){g("empty");return}n=e,S({q:t,lang:m.value,stars:p.value,sort:v.value,page:e>1?e:null}),g("loading");try{const a=await w(t,{language:m.value,minStars:parseInt(p.value)||0,sort:v.value,page:e});b=a.data.total_count,N.innerHTML=`<strong>${f(b)}</strong> repositories found`,G(a.data.items),j(),g("results"),a.rateLimit&&C(a.rateLimit)}catch(a){U.textContent=a.message,g("error")}},K=e=>{const t=e.target.closest(".repo-card__favorite");if(!t)return;const a=JSON.parse(t.dataset.repo);r.isFavorite(a.id)?(r.removeFavorite(a.id),t.classList.remove("active"),t.innerHTML=c.starOutline,u("Removed from favorites","info")):(r.addFavorite(a),t.classList.add("active"),t.innerHTML=c.star,u("Added to favorites","success"))},Q=e=>{const t=e.target.closest(".pagination__btn");if(!t||t.disabled||!t.dataset.page)return;const a=parseInt(t.dataset.page);d(a),window.scrollTo({top:0,behavior:"smooth"})},V=()=>{const e=l("q"),t=l("lang"),a=l("stars"),s=l("sort"),o=l("page");e&&(L.value=e),t&&(m.value=t),a&&(p.value=a),s&&(v.value=s),e&&d(parseInt(o)||1)};H.addEventListener("click",()=>d(1));L.addEventListener("keydown",e=>{e.key==="Enter"&&d(1)});const E=F(()=>d(1),500);m.addEventListener("change",E);p.addEventListener("change",E);v.addEventListener("change",E);_.addEventListener("click",K);h.addEventListener("click",Q);A?.addEventListener("click",()=>d(n));q.addEventListener("click",M);D.addEventListener("click",()=>{y.value=r.getToken()||"",i.classList.add("open")});O.addEventListener("click",()=>{i.classList.remove("open")});i.addEventListener("click",e=>{e.target===i&&i.classList.remove("open")});x.addEventListener("click",()=>{const e=y.value.trim();r.setToken(e),i.classList.remove("open"),u(e?"Token saved":"Token cleared","success")});z.addEventListener("click",()=>{r.setToken(null),y.value="",u("Token cleared","info")});V();
